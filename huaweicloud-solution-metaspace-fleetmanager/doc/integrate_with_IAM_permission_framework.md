###### *注：FleetManager第一阶段可以仅先对接IAM实现Token验签，满足可邀测上线要求。等到服务正式公测时，再对接公有云十统一规范，按照要求实现通过ABAC方式接入IAM，实现权限管控。*
## 1、方案
### 1.1）FleetManager对接IAM实现token验签
#### 1.1.1）获取证书
FleetManager调用内部IAM API "GET /v3/OS-SIMPLE-CERT/certificates"获取签名证书。
###### _注：FleetManager直接从IAM endpoint获取，不存在请求中转场景，所以不需要获取CA证书来验证签名证书的合法性，仅需要获取签名证书即可。_

#### 1.1.2）缓存证书
FleetManager将证书加载至缓存，默认保存8小时，过期后从IAM重新获取，方便老证书自动下线。
FleetManager解析Token失败后，从IAM重新查询证书，和本地缓存证书比较，如果不一致则刷新缓存并重新解析Token，再次解析失败说明token无效。
###### _注：根据安全合规要求，token签名证书会定期更新，FleetManager需要支持不中断业务的证书优雅轮换。在轮换场景下IAM提供的证书文件中含有多份证书，FleetManager需要加载多份证书，并在验签token时根据token中的证书编号找到对应的证书进行验证。_

#### 1.1.3）验签和解析token
##### Decode PKI Token并反序列化为对象。
##### 获取对象里的签名证书信息（序列号）。
##### 根据证书信息反查本地缓存的证书库获取对应的签名证书。
##### 通过CA验证签名证书，确保证书是可信的。
##### 验证Token签名，获取Token明文。

### 1.2）FleetManager通过ABAC方式接入IAM，支持操作、资源级细粒度鉴权（公测前设计实现）
#### 暂不支持

## 2、工作量评估
代码量约2K，预估1人月（+联调验证）

## 3、开发及上线计划
#### 3.1）完善证书缓存刷新代码流程
#### 3.2）完成线上联调

#### 风险：依赖组网方案中的FM访问内部IAM（租户Pod区访问内部IAM）